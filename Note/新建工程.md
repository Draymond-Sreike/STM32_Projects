# 新建工程

![image-20230109160619866](E:\Typora\Image\image-20230109160619866.png)

然后新建一个文件夹来存（快捷键Ctrl+Shift+n快速新建文件夹）

![image-20230109160707171](E:\Typora\Image\image-20230109160707171.png)

然后点击进入新建的文件夹内部，在内部将文件名命名为Project，然后点击保存即可，如下图所示

![image-20230109161004463](E:\Typora\Image\image-20230109161004463.png)

之后会弹出一个选型窗口，选择对应的MCU型号

![image-20230109161309629](E:\Typora\Image\image-20230109161309629.png)

例如我们学的是STM32F103C8T6，我们就找到STM32F103C8型号，点击OK

![image-20230109161514002](E:\Typora\Image\image-20230109161514002.png)

之后会弹出的这个是Keil软件新建工程的小助手，可以帮助我们快速新建工程，但我们暂时不用这个小助手

![image-20230109160207337](E:\Typora\Image\image-20230109160207337.png)

 接下来需要给工程添加必要的工程文件，找到Libraries

![image-20230109162604974](E:\Typora\Image\image-20230109162604974.png)

在Libraries中一直找到arm

![image-20230109162705899](E:\Typora\Image\image-20230109162705899.png)

arm里面这些就是**STM32的启动文件**，STM32的程序就是从启动文件开始执行的，我们需要把这些文件全部复制下来，然后回到我们刚才建的文件夹“2-1 STM32工程模板”中，把这些文件都放进去

![image-20230109162724962](E:\Typora\Image\image-20230109162724962.png)

我们在我们刚才建的文件夹中，再建一个文件夹Start来存放这些复制过来的文件（Start就作为我们存放启动文件的文件夹）

![image-20230109163355535](E:\Typora\Image\image-20230109163355535.png)

![image-20230109163407577](E:\Typora\Image\image-20230109163407577.png)

然后我们再回到arm文件上级的文件STM32F10x中，里面有这些文件

> ![image-20230109163517130](E:\Typora\Image\image-20230109163517130.png)
>
> 1. stm32f10x.h就是STM32的外设寄存器描述文件（类似于51单片机的头文件REGX52.H一样），是用来描述STM32有哪些寄存器和它的对应地址的
> 2. 而后面两个system文件是用来配置时钟的，STM32主频72MHz就是system文件里面的函数配置的

这三个文件也需要复制下来，同样放到Start中。

接下来还要添加**内核寄存器**的描述文件，我们同样再在Libraries中找到文件夹CoreSupport并打开，这里面的两个cm3文件就是内核的寄存器描述（当然它还带了些内核的配置函数，所以多了个.c文件）

![image-20230109164530186](E:\Typora\Image\image-20230109164530186.png)

我们把这两个文件也复制到工程中的Start文件中。

最后工程的必要启动文件就复制完成了，如下图

![image-20230109164749910](E:\Typora\Image\image-20230109164749910.png)

然后我们回到Keil，把刚才复制的那些文件添加到Keil的工程中来，我们把Keil中工程文件目录的Source Group 1改名为Start（与我们刚才在Keil外建的Start文件夹同名，一般都是这样，外面建什么，Keil里面就跟着建同名的文件夹）

![image-20230109164956652](E:\Typora\Image\image-20230109164956652.png)

然后选择添加已经存在的文件到组中

<img src="E:\Typora\Image\image-20230109165354983.png" alt="image-20230109165354983" style="zoom:50%;" />

接着把Start中的md.s文件选中添加进来（为什么选md后缀的文件后面再说）

<img src="E:\Typora\Image\image-20230109165736007.png" alt="image-20230109165736007" style="zoom:50%;" />

然后还要把其他所有的.c和.h文件添加进来

<img src="E:\Typora\Image\image-20230109165906611.png" alt="image-20230109165906611" style="zoom:50%;" />

<img src="E:\Typora\Image\image-20230109165935718.png" alt="image-20230109165935718" style="zoom:50%;" />

这样Start里面的文件就添加好了，如下

<img src="E:\Typora\Image\image-20230109170044010.png" alt="image-20230109170044010" style="zoom:50%;" />

这些都是STM32最基本的文件，文件图标上面带着一把小钥匙表示这些文件是只读文件，我们打开之后可以查看，但是无法修改。

最后我们还需要在工程选项里添加这个文件夹的头文件路径，要不然Keil是找不到.h文件的。

我们点击Keil上方工具栏的"魔术棒"

![image-20230109170336907](E:\Typora\Image\image-20230109170336907.png)

然后按照下面顺序找到`...`按钮

<img src="E:\Typora\Image\image-20230109170622436.png" alt="image-20230109170622436" style="zoom:50%;" />

接着按如下图示操作

<img src="E:\Typora\Image\image-20230109170651860.png" alt="image-20230109170651860" style="zoom:33%;" />

<img src="E:\Typora\Image\image-20230109170701991.png" alt="image-20230109170701991" style="zoom:33%;" />

<img src="E:\Typora\Image\image-20230109170730648.png" alt="image-20230109170730648" style="zoom:33%;" />

最后把Start的路径添加进来。

<img src="E:\Typora\Image\image-20230109170811959.png" alt="image-20230109170811959" style="zoom:50%;" />

再点击OK，就把Start文件夹的头文件路径添加进来了

<img src="E:\Typora\Image\image-20230109170852425.png" alt="image-20230109170852425" style="zoom:50%;" />

最后点击OK就可以了。

然后我们用main函数来检验一下。我们先建一个Use文件夹，等下就来放main函数

![image-20230109180534791](E:\Typora\Image\image-20230109180534791.png)

对应的在Keil中我们也要继续建相对应的文件夹，按照下图所示步骤进行建立

<img src="E:\Typora\Image\image-20230109181056480.png" alt="image-20230109181056480" style="zoom:50%;" />

<img src="E:\Typora\Image\image-20230109181125042.png" alt="image-20230109181125042" style="zoom: 50%;" />

然后要在User中建一个 main.c文件

<img src="E:\Typora\Image\image-20230109181156136.png" alt="image-20230109181156136" style="zoom:50%;" />

![image-20230109181243764](E:\Typora\Image\image-20230109181243764.png)

这里注意要选择好路径，放在User里面

<img src="E:\Typora\Image\image-20230109181310807.png" alt="image-20230109181310807" style="zoom: 50%;" />

最后点击Add

<img src="E:\Typora\Image\image-20230109181335230.png" alt="image-20230109181335230" style="zoom:50%;" />

这样就有了main.c文件了，并且在计算机对应路径下也有main.c文件

<img src="E:\Typora\Image\image-20230109181428179.png" alt="image-20230109181428179" style="zoom:50%;" />

<img src="E:\Typora\Image\image-20230109181536324.png" alt="image-20230109181536324" style="zoom:50%;" />

然后我们在keil中的main.c中开始操作：

插入头文件

![image-20230109212545240](E:\Typora\Image\image-20230109212545240.png)

最后写一个main函数

![image-20230109213124986](E:\Typora\Image\image-20230109213124986.png)

**这里要注意文件最后一行要是空行，否则会报警告**

最后编译建立工程
![image-20230109213231193](E:\Typora\Image\image-20230109213231193.png)

 ![image-20230109215539098](E:\Typora\Image\image-20230109215539098.png)

如字幕所示，0错误0警告说明我们建的工程没有问题。

目前的工程还没有添加STM32的库函数，所以它暂时还是一个基于寄存器开发的工程。

## 配置调试器

点击工具箱的魔术棒按钮，然后按如下图示操作

<img src="E:\Typora\Image\image-20230109230735090.png" alt="image-20230109230735090" style="zoom:50%;" />

选择ST-Link Debugger

<img src="E:\Typora\Image\image-20230109232627692.png" alt="image-20230109232627692" style="zoom:50%;" />

再点击旁边的设置按钮

<img src="E:\Typora\Image\image-20230109232739703.png" alt="image-20230109232739703" style="zoom:50%;" />

选择Flash Download这一项并把Reset and Run选上

<img src="E:\Typora\Image\image-20230109232803583.png" alt="image-20230109232803583" style="zoom:50%;" />

勾上这一项之后我们下载程序到STM32里面会立马复位并执行，否则每次下载之后还需要按一下板子上的复位按键才能执行程序

# 拓展

## 字体调节

找到工具栏的扳手图标

![image-20230109220703694](E:\Typora\Image\image-20230109220703694.png)

<img src="E:\Typora\Image\image-20230109220743378.png" alt="image-20230109220743378" style="zoom:50%;" />

调C/C++编辑器的字体

<img src="E:\Typora\Image\image-20230109220858129.png" alt="image-20230109220858129" style="zoom:50%;" />

<img src="E:\Typora\Image\image-20230109220916065.png" alt="image-20230109220916065" style="zoom:50%;" />

<img src="E:\Typora\Image\image-20230109221533234.png" alt="image-20230109221533234" style="zoom:50%;" />

再调一个Asm编辑器的字体

<img src="E:\Typora\Image\image-20230109221002404.png" alt="image-20230109221002404" style="zoom:50%;" />

<img src="E:\Typora\Image\image-20230109221019347.png" alt="image-20230109221019347" style="zoom:50%;" />

## 编码格式调节

同样是在工具栏的扳手图标里面

<img src="E:\Typora\Image\image-20230109222149559.png" alt="image-20230109222149559" style="zoom:50%;" />

选择UTF-8

<img src="E:\Typora\Image\image-20230109222322133.png" alt="image-20230109222322133" style="zoom:50%;" />

这样可以防止出现一些中文乱码的问题。

如果打开别人的工程发现是乱码，可能还需要再修改一下这个编码格式

此外在这同一页还可以调节TAB的缩进空格个数，一般选择4个

## 调节缩进空格个数

<img src="E:\Typora\Image\image-20230109222832371.png" alt="image-20230109222832371" style="zoom: 50%;" />