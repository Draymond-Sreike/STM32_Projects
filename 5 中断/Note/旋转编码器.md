# 旋转编码器

## 正转

编码器正向旋转时的输出波形如下：

> 上下两个波形分别为编码A、B引脚的输出波形
>
> ![image-20230201203226826](D:\大学\单片机学习\MCU Learning Resource\STM32\STM32_Projects\5 中断\Note\image-20230201203226826.png)

## 反转

> 上下两个波形分别为编码A、B引脚的输出波形
>
> ![image-20230201203353879](D:\大学\单片机学习\MCU Learning Resource\STM32\STM32_Projects\5 中断\Note\image-20230201203353879.png)

## 程序判断编码器正反转

如果把一相的下降沿作为中断触发信号，则在这个中断触发的同一时刻读取另一相的电平就可以判断编码器的正反转了：

- 正转：A相下降沿，B相高电平
- 反转：A相下降沿，B相低电平

> 区分图示如下：
>
> <img src="D:\大学\单片机学习\MCU Learning Resource\STM32\STM32_Projects\5 中断\Note\image-20230201203908820.png" alt="image-20230201203908820" style="zoom:50%;" />

当然如果是这样的区分方式会导致判断正转时，是我们刚开始拧动编码器就触发中断，而判断反转时，是我们拧动编码器转到位了才触发中断。

这样触发中断的时机稍有不同，但也能正确地进行判断正反转。

如果我们要统一触发中断的时机，可以编程让A、B相都能触发中断，如下图：

> <img src="D:\大学\单片机学习\MCU Learning Resource\STM32\STM32_Projects\5 中断\Note\image-20230201204741646.png" alt="image-20230201204741646" style="zoom:50%;" />

此时我们统一在编码器**拧到位时才来触发中断**

- 正转拧到位时，B相产生下降沿触发中断，马上判断A相的低电平，此时对应正转
- 反转拧到位时，A相产生下降沿触发中断，马上判断B相的低电平，此时对应反转

 